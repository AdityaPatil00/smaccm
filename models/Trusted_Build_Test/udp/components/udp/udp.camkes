/*
 * Copyright 2014, NICTA
 *
 * This software may be distributed and modified according to the terms of
 * the GNU General Public License version 2. Note that NO WARRANTY is provided.
 * See "LICENSE_GPLv2.txt" for details.
 *
 * @TAG(NICTA_GPL)
 */

import <Ethdriver.idl4>;
import <PutChar.idl4>;

import "../../interfaces/udp__packet_i_writer.idl4";

component HWEthDriver {
    hardware;
    emits IRQ irq;
    dataport EthDriverMMIO mmio;
};

component udp {
    include "smaccm_wrapper_i_types.h";
    control;

    /* AADL expected interface */
    provides udp__packet_i_writer client_input;
    uses udp__packet_i_writer udp_client_output;

    /* Driver interface */
    include "c162/EthType.h";
    has mutex ethdriver;
    uses PutChar putchar;

    provides Ethdriver client0;
    emits Notification rx_ready0;
    maybe dataport Buf packet0;

    /* Hardware interface */
    consumes IRQ irq;
    dataport EthDriverMMIO_t EthDriver;
}

assembly {
    composition {
        component HWEthDriver HWEthDriver;

        connection seL4HardwareMMIO ethdrivermmio1(from udp_inst.EthDriver, to HWEthDriver.mmio);
        connection seL4IOAPICHardwareInterrupt hwethirq(from HWEthDriver.irq, to udp_inst.irq);
    }

    configuration {
        HWEthDriver.mmio_attributes = "0xf1b80000:0x80000";
        HWEthDriver.irq_attributes = "16,1,1";
    }
}
